# SWAP Transaction Classification - Detailed Guide

## üéØ –ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

### **SOL-First Classification**

```
SOL –ø–æ—Ç—Ä–∞—á–µ–Ω (negative) = BUY (–ø–æ–∫—É–ø–∫–∞ —Ç–æ–∫–µ–Ω–∞ –∑–∞ SOL)
SOL –ø–æ–ª—É—á–µ–Ω (positive) = SELL (–ø—Ä–æ–¥–∞–∂–∞ —Ç–æ–∫–µ–Ω–∞ –∑–∞ SOL)
```

–≠—Ç–æ **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±** –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∞ Solana!

---

## üìã –¢–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ Solana

### 1. **SWAP** (–û–±–º–µ–Ω)
–û–±–º–µ–Ω –æ–¥–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –¥—Ä—É–≥–æ–π —á–µ—Ä–µ–∑ DEX (Raydium, Jupiter, Orca –∏ —Ç.–¥.)

**–ü—Ä–∏–º–µ—Ä—ã:**
- SOL ‚Üí BONK (–ø–æ–∫—É–ø–∫–∞ BONK –∑–∞ SOL)
- BONK ‚Üí SOL (–ø—Ä–æ–¥–∞–∂–∞ BONK –∑–∞ SOL)
- USDC ‚Üí BONK (–ø–æ–∫—É–ø–∫–∞ BONK –∑–∞ USDC)

### 2. **TRANSFER** (–ü–µ—Ä–µ–≤–æ–¥)
–ü—Ä–æ—Å—Ç–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–æ–≤ –º–µ–∂–¥—É –∫–æ—à–µ–ª—å–∫–∞–º–∏

### 3. **MINT/BURN**
–°–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

---

## üìä –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –±–∞–∑—ã

### ‚úÖ –ü—Ä–∏–º–µ—Ä 1: BUY USD1

```json
{
  "transaction_type": "BUY",
  "token_symbol": "USD1",
  "amount": "9.631912",
  "sol_amount": "-0.072448938",  // ‚Üê –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ = –ø–æ—Ç—Ä–∞—Ç–∏–ª SOL
  "current_token_price": "0.99599364"
}
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
1. –¢—Ä–µ–π–¥–µ—Ä –ø–æ—Ç—Ä–∞—Ç–∏–ª 0.072 SOL
2. –¢—Ä–µ–π–¥–µ—Ä –ø–æ–ª—É—á–∏–ª 9.63 USD1
3. –≠—Ç–æ **–ø–æ–∫—É–ø–∫–∞ USD1 –∑–∞ SOL** ‚úÖ

---

### ‚úÖ –ü—Ä–∏–º–µ—Ä 2: SELL USACOIN

```json
{
  "transaction_type": "SELL",
  "token_symbol": "USACOIN",
  "amount": "130681.701199",
  "sol_amount": "1.126280276",  // ‚Üê –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ = –ø–æ–ª—É—á–∏–ª SOL
}
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
1. –¢—Ä–µ–π–¥–µ—Ä –ø—Ä–æ–¥–∞–ª 130,681 USACOIN
2. –¢—Ä–µ–π–¥–µ—Ä –ø–æ–ª—É—á–∏–ª 1.126 SOL
3. –≠—Ç–æ **–ø—Ä–æ–¥–∞–∂–∞ USACOIN –∑–∞ SOL** ‚úÖ

---

### ‚úÖ –ü—Ä–∏–º–µ—Ä 3: Multiple SHADOWVP SELLS (–ß–∞—Å—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏)

```json
// –ü—Ä–æ–¥–∞–∂–∞ #1
{
  "transaction_type": "SELL",
  "token_symbol": "SHADOWVP",
  "amount": "27586242.800683055",
  "sol_amount": "5.008",  // ‚Üê –ü–æ–ª—É—á–∏–ª SOL
  "block_time": "04:27:24"
}

// –ü—Ä–æ–¥–∞–∂–∞ #2
{
  "transaction_type": "SELL",
  "token_symbol": "SHADOWVP",
  "amount": "9195414.266894352",
  "sol_amount": "2.163",  // ‚Üê –ü–æ–ª—É—á–∏–ª SOL
  "block_time": "04:26:44"
}

// –ü—Ä–æ–¥–∞–∂–∞ #3
{
  "transaction_type": "SELL",
  "token_symbol": "SHADOWVP",
  "amount": "42419786.88353018",
  "sol_amount": "8.488",  // ‚Üê –ü–æ–ª—É—á–∏–ª SOL
  "block_time": "04:25:28"
}
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- –¢—Ä–µ–π–¥–µ—Ä –¥–µ–ª–∞–µ—Ç **3 —á–∞—Å—Ç–∏—á–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂–∏** SHADOWVP –∑–∞ 2 –º–∏–Ω—É—Ç—ã
- –û–±—â–∞—è –ø—Ä–æ–¥–∞–∂–∞: 79.2M SHADOWVP ‚Üí 15.8 SOL
- P&L —Å–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∫–∞–∂–¥—É—é –ø—Ä–æ–¥–∞–∂—É –æ—Ç–¥–µ–ª—å–Ω–æ ‚úÖ

---

## üîç –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 1Ô∏è‚É£ **PRIORITY 1: Native SOL Transfers** ‚≠ê (–°–ê–ú–´–ô –ù–ê–î–ï–ñ–ù–´–ô!)

```typescript
if (data.nativeTransfers && data.nativeTransfers.length > 0) {
  for (const transfer of data.nativeTransfers) {
    // Wallet SENDS SOL = BUY
    if (transfer.fromUserAccount === walletAddress) {
      return "BUY";
    }
    // Wallet RECEIVES SOL = SELL
    if (transfer.toUserAccount === walletAddress) {
      return "SELL";
    }
  }
}
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–±?**
- ‚úÖ Native SOL transfers –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å –≤ SWAP
- ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å
- ‚úÖ –Ø—Å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ–Ω–µ–∂–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞

### 2Ô∏è‚É£ **PRIORITY 2: Token Transfers**

–ü—Ä–æ–≤–µ—Ä–∫–∞ wrapped SOL –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤

### 3Ô∏è‚É£ **PRIORITY 3: Transaction Type Label**

Fallback –Ω–∞ –ø—Ä—è–º—ã–µ –º–µ—Ç–∫–∏ —Ç–∏–ø–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

---

## ‚ö†Ô∏è Edge Cases

### Edge Case #1: SPL —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è

```json
{
  "transaction_type": "BUY",
  "token_symbol": "SPL",
  "amount": "72336613.71436",
  "sol_amount": "-0.043",  // ‚Üê SWAP: –ø–æ—Ç—Ä–∞—Ç–∏–ª SOL
  "native_balance_change": "+3.107"  // ‚Üê –î—Ä—É–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è: –ø–æ–ª—É—á–∏–ª SOL
}
```

**–ü–æ—á–µ–º—É `native_balance_change` –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π?**
- –í –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π**
- `sol_amount` = —á–∏—Å—Ç—ã–π SWAP (-0.043 SOL –Ω–∞ –ø–æ–∫—É–ø–∫—É SPL)
- `native_balance_change` = **–≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** (+3.107 SOL –æ—Ç –¥—Ä—É–≥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏)

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è:**
- **–í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–µ–º `sol_amount`** –¥–ª—è SWAP
- `sol_amount` < 0 ‚üπ **BUY** ‚úÖ

---

## üé® –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ KOL Feed

### BUY —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üü¢ BUY USD1                                 ‚îÇ
‚îÇ Amount: 9.63 USD1                           ‚îÇ
‚îÇ SOL Spent: -0.072 SOL                       ‚îÇ
‚îÇ Price: $0.996                               ‚îÇ
‚îÇ P&L: +$0.02 (+2.0%) ‚úÖ                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### SELL —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üî¥ SELL SHADOWVP                            ‚îÇ
‚îÇ Amount: 27.5M SHADOWVP                      ‚îÇ
‚îÇ SOL Received: +5.008 SOL                    ‚îÇ
‚îÇ Price: $0.00002943                          ‚îÇ
‚îÇ P&L: +$259.86 (+47.2%) ‚úÖ                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: BUY –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å negative sol_amount

```sql
SELECT COUNT(*) as incorrect_buys
FROM webhook_transactions
WHERE transaction_type = 'BUY'
  AND sol_amount::numeric > 0;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** 0

### –¢–µ—Å—Ç 2: SELL –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å positive sol_amount

```sql
SELECT COUNT(*) as incorrect_sells
FROM webhook_transactions
WHERE transaction_type = 'SELL'
  AND sol_amount::numeric < 0;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** 0

---

## üéØ Summary

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è:

1. **BUY** = Wallet –ø–æ—Ç—Ä–∞—Ç–∏–ª SOL (`sol_amount` < 0)
2. **SELL** = Wallet –ø–æ–ª—É—á–∏–ª SOL (`sol_amount` > 0)
3. –ò—Å–ø–æ–ª—å–∑—É–µ–º **Native SOL transfers** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç #1)
4. P&L —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
5. –ß–∞—Å—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è

### üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–π –±–∞–∑—ã:

- ‚úÖ **20 BUY** —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 —á–∞—Å–∞
- ‚úÖ **17 SELL** —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 —á–∞—Å–∞
- ‚úÖ –í—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ P&L —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ!** üéâ
